databaseChangeLog:
  - preConditions:
      - runningAs:
          username: root

  - changeSet:
      id: create-auth-tables-1
      author: gavinkillough
      preConditions:
        onFail: MARK_RAN
        not:
          tableExists:
            schemaName: portal
            tableName: licenses
      changes:
        - createTable:
            schemaName: portal
            tableName: licenses
            columns:
              - column:
                  name: license_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: license_hash
                  type: UUID
                  constraints:
                    unique: true
              - column:
                  name: expiration_date
                  type: DATE
              - column:
                  name: type
                  type: VARCHAR
              - column:
                  name: license_seats
                  type: INTEGER
              - column:
                  name: monthly_cost
                  type: DOUBLE PRECISION
              - column:
                  name: is_active
                  type: BOOLEAN
                  defaultValueBoolean: true

  - changeSet:
      id: create-auth-tables-2
      author: gavinkillough
      preConditions:
        onFail: MARK_RAN
        not:
          tableExists:
            schemaName: portal
            tableName: organizations
      changes:
        - createTable:
            schemaName: portal
            tableName: organizations
            columns:
              - column:
                  name: organization_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: organization_name
                  type: VARCHAR
              - column:
                  name: is_active
                  type: BOOLEAN
                  defaultValueBoolean: true

  - changeSet:
      id: create-auth-tables-3
      author: gavinkillough
      preConditions:
        onFail: MARK_RAN
        not:
          tableExists:
            schemaName: portal
            tableName: organization_account_addresses
      changes:
        - createTable:
            schemaName: portal
            tableName: organization_account_addresses
            columns:
              - column:
                  name: organization_account_address_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: street_number
                  type: INTEGER
              - column:
                  name: street_name
                  type: VARCHAR
              - column:
                  name: apt_suite
                  type: VARCHAR
              - column:
                  name: city
                  type: VARCHAR
              - column:
                  name: state
                  type: VARCHAR(2)
              - column:
                  name: zip_code
                  type: VARCHAR(10)
              - column:
                  name: is_business
                  type: BOOLEAN

  - changeSet:
      id: create-auth-tables-3a
      author: gavinkillough
      preConditions:
        onFail: MARK_RAN
        not:
          tableExists:
            schemaName: portal
            tableName: organization_accounts
      changes:
        - createTable:
            schemaName: portal
            tableName: organization_accounts
            columns:
              - column:
                  name: organization_account_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: organization_account_name
                  type: VARCHAR
                  constraints:
                    unique: true
              - column:
                  name: license_id
                  type: BIGINT
                  constraints:
                    referencedschemaName: portal
                    referencedTableName: licenses
                    referencedColumnName: license_id
              - column:
                  name: organization_id
                  type: BIGINT
                  constraints:
                    referencedschemaName: portal
                    referencedTableName: organizations
                    referencedColumnName: organization_id
              - column:
                  name: organization_account_address_id
                  type: BIGINT
                  constraints:
                    referencedschemaName: portal
                    referencedTableName: organization_account_addresses
                    referencedColumnName: organization_account_address_id
              - column:
                  name: is_active
                  type: BOOLEAN
                  defaultValueBoolean: true

  - changeSet:
      id: create-auth-tables-4
      author: gavinkillough
      preConditions:
        onFail: MARK_RAN
        not:
          tableExists:
            schemaName: portal
            tableName: roles
      changes:
        - createTable:
            schemaName: portal
            tableName: roles
            columns:
              - column:
                  name: role_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: role_level
                  type: VARCHAR
                  constraints:
                    unique: true
              - column:
                  name: role_description
                  type: VARCHAR
              - column:
                  name: is_role_restricted
                  type: BOOLEAN

  - changeSet:
      id: create-auth-tables-5
      author: gavinkillough
      preConditions:
        onFail: MARK_RAN
        not:
          tableExists:
            schemaName: portal
            tableName: users
      changes:
        - createTable:
            schemaName: portal
            tableName: users
            columns:
              - column:
                  name: user_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: email
                  type: VARCHAR
                  constraints:
                    unique: true
                    nullable: false
              - column:
                  name: first_name
                  type: VARCHAR
              - column:
                  name: last_name
                  type: VARCHAR
              - column:
                  name: is_active
                  type: BOOLEAN
                  defaultValueBoolean: true

  - changeSet:
      id: create-auth-tables-6
      author: gavinkillough
      preConditions:
        onFail: MARK_RAN
        not:
          tableExists:
            schemaName: portal
            tableName: logins
      changes:
        - createTable:
            schemaName: portal
            tableName: logins
            columns:
              - column:
                  name: login_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    referencedschemaName: portal
                    referencedTableName: users
                    referencedColumnName: user_id
              - column:
                  name: password_salt
                  type: VARCHAR
              - column:
                  name: password_hash
                  type: VARCHAR
              - column:
                  name: last_successful_login
                  type: DATE
              - column:
                  name: num_failed_logins
                  type: INTEGER

  - changeSet:
      id: create-auth-tables-7
      author: gavinkillough
      preConditions:
        onFail: MARK_RAN
        not:
          tableExists:
            schemaName: portal
            tableName: memberships
      changes:
        - createTable:
            schemaName: portal
            tableName: memberships
            columns:
              - column:
                  name: membership_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    referencedschemaName: portal
                    referencedTableName: users
                    referencedColumnName: user_id
              - column:
                  name: organization_account_id
                  type: BIGINT
                  constraints:
                    referencedschemaName: portal
                    referencedTableName: organization_accounts
                    referencedColumnName: organization_account_id
              - column:
                  name: role_id
                  type: BIGINT
                  constraints:
                    referencedschemaName: portal
                    referencedTableName: roles
                    referencedColumnName: role_id
              - column:
                  name: is_active
                  type: BOOLEAN
                  defaultValueBoolean: true

  - changeSet:
      id: create-auth-tables-8
      author: gavinkillough
      preConditions:
        onFail: MARK_RAN
        not:
          tableExists:
            schemaName: portal
            tableName: user_addresses
      changes:
        - createTable:
            schemaName: portal
            tableName: user_addresses
            columns:
              - column:
                  name: user_address_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: street_number
                  type: INTEGER
              - column:
                  name: street_name
                  type: VARCHAR
              - column:
                  name: apt_suite
                  type: VARCHAR
              - column:
                  name: city
                  type: VARCHAR
              - column:
                  name: state
                  type: VARCHAR(2)
              - column:
                  name: zip_code
                  type: VARCHAR(10)
              - column:
                  name: is_business
                  type: BOOLEAN

  - changeSet:
      id: create-auth-tables-9
      author: gavinkillough
      preConditions:
        onFail: MARK_RAN
        not:
          tableExists:
            schemaName: portal
            tableName: profiles
      changes:
        - createTable:
            schemaName: portal
            tableName: profiles
            columns:
              - column:
                  name: profile_id
                  type: BIGSERIAL
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    referencedschemaName: portal
                    referencedTableName: users
                    referencedColumnName: user_id
              - column:
                  name: mobile_number
                  type: VARCHAR
              - column:
                  name: business_number
                  type: VARCHAR
              - column:
                  name: mailing_address_id
                  type: BIGINT
                  constraints:
                    referencedschemaName: portal
                    referencedTableName: users
                    referencedColumnName: user_id